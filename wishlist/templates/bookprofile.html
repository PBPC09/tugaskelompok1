{% extends 'base.html' %}
{% block content %}
<head> 
    <style>
        .book-card {
            margin-bottom: 20px;
        }
        .book-details {
            display: none;
        }
        .show-detail-text {
            color: #888;
            cursor: pointer;
            text-decoration: underline;
        }
    </style>
</head>
<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
    <a class="navbar-brand" href="#">Lembar Pena</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        </ul>
        <a class="nav-link active" href="{% url 'main:show_landing_page_logged_in' %}" style="margin-right: 30px;">Home</a>
        <a class="nav-link active" href="{% url 'wishlist:bookprofile' %}" style="margin-right: 30px;">Wishlist</a>
        <a class="nav-link active" href="{% url 'buybooks:show_test' %}" style="margin-right: 30px;">Buy Books</a>
        <a class="nav-link active" href="{% url 'bookforum:show_forum' %}" style="margin-right: 30px;">Book Forum</a>
        <a class="btn btn-outline-success" style="margin-right: 10px;" href="{% url 'main:logout' %}">Logout</a>    
    </div>
</nav>
<div class="container mt-5">
    <h1>Books</h1>
    <div class="row">
        {% for book in books %}
        <div class="col-md-4 mb-4">
            <div class="book-card">
                <h5 class="card-title">{{ book.title }}</h5>
                <p class="show-detail-text" data-book-id="{{ book.id }}">Show Detail</p>
                <div class="book-details" data-book-id="{{ book.id }}">
                    <p class="card-text"><strong>Author:</strong> {{ book.author }}</p>
                    <p class="card-text"><strong>Rating:</strong> {{ book.rating }}</p>
                    <p class="card-text"><strong>Voters:</strong> {{ book.voters }}</p>
                    <p class="card-text"><strong>Price:</strong> {{ book.price }} {{ book.currency }}</p>
                    <p class="card-text"><strong>Publisher:</strong> {{ book.publisher }}</p>
                    <p class="card-text"><strong>Page Count:</strong> {{ book.page_count }}</p>
                    <p class="card-text"><strong>Genres:</strong> {{ book.genres }}</p>
                    <button type="button" class="btn btn-primary add-to-wishlist-btn" data-bs-toggle="modal" data-bs-target="#exampleModal">Add to Wishlist by AJAX</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="modal fade" id="wishlistModal" tabindex="-1" role="dialog" aria-labelledby="wishlistModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form id="wishlist-form" method="post" action="{% url 'wishlist:add_to_wishlist' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="wishlistModalLabel">Add to Wishlist</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {{ form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
        $(".show-detail-text").click(function(){
            var bookId = $(this).data("book-id");
            $(".book-details[data-book-id='" + bookId + "']").slideToggle();
        });
    });
    document.addEventListener("DOMContentLoaded", function () {
    // Temukan semua tombol "Add to Wishlist"
    const addToWishlistButtons = document.querySelectorAll(".add-to-wishlist-button");

    // Tambahkan event listener pada setiap tombol
    addToWishlistButtons.forEach((button) => {
        button.addEventListener("click", function () {
            // Dapatkan ID buku dari atribut data-book-id
            const bookId = button.getAttribute("data-book-id");

            // Panggil fungsi addToWishlist dengan ID buku
            addToWishlist(bookId);
        });
    });
});

// Fungsi untuk menambahkan buku ke Wishlist
async function addToWishlist(bookId) {
    try {
        // Kirim permintaan POST ke URL yang sesuai di sisi server Anda
        const response = await fetch("{% url 'wishlist:add_to_wishlist' %}", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val()
            },
            body: JSON.stringify({
                book_id: bookId
            })
        });

        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                // Tampilkan pemberitahuan bahwa buku telah ditambahkan ke Wishlist
                alert("Added to wishlist successfully!");
            } else {
                // Tampilkan pemberitahuan jika gagal menambahkan ke Wishlist
                alert("Failed to add to wishlist.");
            }
        } else {
            throw new Error("Network response was not ok.");
        }
    } catch (error) {
        // Tangani kesalahan jika terjadi
        alert("An error occurred while adding to wishlist: " + error.message);
    }
}


    // Fungsi yang sama dengan yang ada pada contoh sebelumnya
    function removeItem(bookId) {
        // Implementasi AJAX DELETE di sini
    }


</script>

<!-- ini pake jquery udah jalan -->
<!-- <script>
$(document).ready(function(){
    $(".show-detail-text").click(function(){
        var bookId = $(this).data("book-id");
        $(".book-details[data-book-id='" + bookId + "']").slideToggle();
    });
     $(".add-to-wishlist-button").click(function(){
        var bookId = $(this).data("book-id");
        $("#id_book_id").val(bookId);
        $("#wishlistModal").modal("show");
    });
});
</script> -->

<!-- ini pake yang kaya di tutor tapi belom test takut error -->
<!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
        const showDetailTexts = document.querySelectorAll(".show-detail-text");
        showDetailTexts.forEach((showDetailText) => {
            showDetailText.addEventListener("click", function () {
                const bookId = this.getAttribute("data-book-id");
                const bookDetails = document.querySelector(`.book-details[data-book-id='${bookId}']`);
                if (bookDetails) {
                    if (bookDetails.style.display === "none" || bookDetails.style.display === "") {
                        bookDetails.style.display = "block";
                    } else {
                        bookDetails.style.display = "none";
                    }
                }
            });
        });
    
        const addToWishlistButtons = document.querySelectorAll(".add-to-wishlist-button");
        addToWishlistButtons.forEach((addToWishlistButton) => {
            addToWishlistButton.addEventListener("click", function () {
                const bookId = this.getAttribute("data-book-id");
                const bookIdField = document.querySelector("#id_book_id");
                if (bookIdField) {
                    bookIdField.value = bookId;
                }
                const wishlistModal = document.querySelector("#wishlistModal");
                if (wishlistModal) {
                    wishlistModal.style.display = "block";
                }
            });
        });
    });
</script> -->

{% endblock %}
